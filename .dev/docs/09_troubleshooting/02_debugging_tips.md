# π” μ£Όμ” κΈ°λ¥λ³„ λ””λ²„κΉ… ν

μ΄ λ¬Έμ„λ” ν”„λ΅μ νΈμ μ£Όμ” κΈ°λ¥μ—μ„ λ¬Έμ κ°€ λ°μƒν–μ„ λ• ν¨κ³Όμ μΌλ΅ λ””λ²„κΉ…ν•  μ μλ” νκ³Ό μ²΄ν¬λ¦¬μ¤νΈλ¥Ό μ κ³µν•©λ‹λ‹¤.

---

### 1. μΈμ¦/μΈκ°€ (JWT) λ¬Έμ 

#### **μ¦μƒ**:
-   API μ”μ²­ μ‹ 401 Unauthorized λλ” 403 Forbidden μ¤λ¥κ°€ λ°μƒν•λ‹¤.
-   λ΅κ·ΈμΈμ€ μ„±κ³µν–μ§€λ§, μΈμ¦μ΄ ν•„μ”ν• λ‹¤λ¥Έ API νΈμ¶μ— κ³„μ† μ‹¤ν¨ν•λ‹¤.

#### **μ²΄ν¬λ¦¬μ¤νΈ λ° λ””λ²„κΉ… ν**:

1.  **`Authorization` ν—¤λ” ν™•μΈ**:
    -   ν΄λΌμ΄μ–ΈνΈκ°€ λ³΄λ‚Έ μ”μ²­ ν—¤λ”μ— `Authorization: Bearer {TOKEN}` ν•μ‹μ΄ μ¬λ°”λ¥΄κ² ν¬ν•¨λμ—λ”μ§€ ν™•μΈν•©λ‹λ‹¤. `Bearer`μ™€ ν† ν° μ‚¬μ΄μ— κ³µλ°±μ΄ μλ”μ§€ ν™•μΈν•μ„Έμ”.

2.  **JWT ν† ν° λ””μ½”λ”©**:
    -   [jwt.io](https://jwt.io/)μ™€ κ°™μ€ μ¨λΌμΈ λ””λ²„κ±°λ¥Ό μ‚¬μ©ν•μ—¬ ν΄λΌμ΄μ–ΈνΈκ°€ λ³΄λ‚Έ Access Tokenμ„ λ¶™μ—¬λ„£κ³  λ‚΄μ©μ„ ν™•μΈν•©λ‹λ‹¤.
        -   `payload` λ¶€λ¶„μ— `sub`(μ‚¬μ©μ ID), `roles`, `exp`(λ§λ£ μ‹κ°„) λ“±μ μ •λ³΄κ°€ μ¬λ°”λ¥΄κ² λ“¤μ–΄μλ”μ§€ ν™•μΈν•©λ‹λ‹¤.
        -   `exp` μ‹κ°„μ΄ ν„μ¬ μ‹κ°„λ³΄λ‹¤ μ΄μ „μΈμ§€ ν™•μΈν•μ—¬ ν† ν°μ΄ λ§λ£λμ§€ μ•μ•λ”μ§€ κ²€μ‚¬ν•©λ‹λ‹¤.

3.  **`JwtAuthorizationFilter` λ””λ²„κΉ…**:
    -   IDEμ—μ„ `JwtAuthorizationFilter` ν΄λμ¤μ `doFilterInternal` λ©”μ†λ“μ— λΈλ μ΄ν¬ν¬μΈνΈ(breakpoint)λ¥Ό μ„¤μ •ν•©λ‹λ‹¤.
    -   APIλ¥Ό μ”μ²­ν•μ—¬ ν”„λ΅κ·Έλ¨ μ‹¤ν–‰μ„ μΌμ‹ μ¤‘μ§€μ‹ν‚¤κ³ , μ•„λ λ³€μλ“¤μ κ°’μ„ λ‹¨κ³„λ³„λ΅ ν™•μΈν•©λ‹λ‹¤.
        -   `header`: `Authorization` ν—¤λ” κ°’μ΄ μ λ€λ΅ λ“¤μ–΄μ¤λ”μ§€ ν™•μΈ.
        -   `jwtToken`: `Bearer` μ ‘λ‘μ‚¬κ°€ μ κ±°λ μμ ν† ν° λ¬Έμμ—΄μ΄ λ§λ”μ§€ ν™•μΈ.
        -   `authentication`: `JwtTokenProvider`κ°€ ν† ν°μ„ μ„±κ³µμ μΌλ΅ νμ‹±ν•μ—¬ `Authentication` κ°μ²΄λ¥Ό μƒμ„±ν•λ”μ§€ ν™•μΈ.

4.  **`SecurityConfig` ν™•μΈ**:
    -   λ¬Έμ κ°€ λ°μƒν•λ” APIμ κ²½λ΅κ°€ `SecurityConfig`μ `authorizeHttpRequests` μ„¤μ •μ—μ„ μ¬λ°”λ¥Έ μ ‘κ·Ό κ¶ν•μ„ κ°€μ§€κ³  μλ”μ§€ ν™•μΈν•©λ‹λ‹¤. (μ: `permitAll`, `hasRole('ADMIN')`, `authenticated`)

---

### 2. AWS S3 / LocalStack μ—°λ™ λ¬Έμ 

#### **μ¦μƒ**:
-   νμΌ μ—…λ΅λ“/λ‹¤μ΄λ΅λ“ μ‹ `SdkClientException: Unable to execute HTTP request` μ¤λ¥κ°€ λ°μƒν•λ‹¤.
-   νμΌμ€ μ—…λ΅λ“λ κ²ƒμ²λΌ λ³΄μ΄λ‚, μ‹¤μ  S3 λ²„ν‚·μ΄λ‚ LocalStackμ—μ„ νμΌμ„ μ°Ύμ„ μ μ—†λ‹¤.

#### **μ²΄ν¬λ¦¬μ¤νΈ λ° λ””λ²„κΉ… ν**:

1.  **LocalStack μ»¨ν…μ΄λ„ μƒνƒ ν™•μΈ**:
    -   `docker ps` λ…λ Ήμ–΄λ΅ `localstack` μ»¨ν…μ΄λ„κ°€ μ •μƒμ μΌλ΅ μ‹¤ν–‰ μ¤‘μΈμ§€ ν™•μΈν•©λ‹λ‹¤.
    -   LocalStackμ Web UI(`http://localhost:8080` λλ” λ‹¤λ¥Έ ν¬νΈ)μ— μ ‘μ†ν•μ—¬ S3 μ„λΉ„μ¤κ°€ ν™μ„±ν™”λμ–΄ μλ”μ§€ ν™•μΈν•©λ‹λ‹¤.

2.  **`application.properties` μ„¤μ • ν™•μΈ**:
    -   `cloud.aws.s3.endpoint`κ°€ LocalStack μ£Όμ†(`http://localhost:4566`)λ΅ μ¬λ°”λ¥΄κ² μ„¤μ •λμ—λ”μ§€ ν™•μΈν•©λ‹λ‹¤.
    -   `cloud.aws.credentials.access-key`μ™€ `secret-key`κ°€ `test`λ΅ μ„¤μ •λμ–΄ μλ”μ§€ ν™•μΈν•©λ‹λ‹¤.
    -   `cloud.aws.region.static` κ°’μ΄ μ¬λ°”λ¥΄κ² μ„¤μ •λμ—λ”μ§€ ν™•μΈν•©λ‹λ‹¤.

3.  **S3 λ²„ν‚· μƒμ„± ν™•μΈ**:
    -   μ• ν”λ¦¬μΌ€μ΄μ…μ΄ μ‹μ‘λ  λ• `S3Config` λλ” κ΄€λ ¨ λ΅μ§μ—μ„ μ„¤μ •λ λ²„ν‚·(`orv-dev-bucket` λ“±)μ΄ LocalStackμ— μ‹¤μ λ΅ μƒμ„±λμ—λ”μ§€ ν™•μΈν•΄μ•Ό ν•©λ‹λ‹¤. LocalStack CLI λλ” Web UIλ¥Ό μ‚¬μ©ν•μ—¬ λ²„ν‚· λ©λ΅μ„ μ΅°νν•©λ‹λ‹¤.
    -   **ν**: LocalStackμ€ μ»¨ν…μ΄λ„κ°€ μ¬μ‹μ‘λ  λ•λ§λ‹¤ λ°μ΄ν„°κ°€ μ΄κΈ°ν™”λ  μ μμµλ‹λ‹¤. ν•„μ”ν•λ‹¤λ©΄ LocalStackμ΄ μ‹μ‘λ  λ• νΉμ • λ²„ν‚·μ„ μλ™μΌλ΅ μƒμ„±ν•λ„λ΅ μ΄κΈ°ν™” μ¤ν¬λ¦½νΈλ¥Ό κµ¬μ„±ν•  μ μμµλ‹λ‹¤.

4.  **`S3VideoRepository` (λλ” κ΄€λ ¨ ν΄λμ¤) λ””λ²„κΉ…**:
    -   νμΌμ„ μ—…λ΅λ“ν•λ” λ΅μ§(μ: `putObject`)μ— λΈλ μ΄ν¬ν¬μΈνΈλ¥Ό μ„¤μ •ν•©λ‹λ‹¤.
    -   `PutObjectRequest` κ°μ²΄μ— `bucket`, `key`(νμΌ κ²½λ΅), `inputStream` λ“±μ κ°’μ΄ μ¬λ°”λ¥΄κ² μ±„μ›μ§€λ”μ§€ ν™•μΈν•©λ‹λ‹¤.
